<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planetárium</title>
    <!-- Ionic framework -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js"></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css" rel="stylesheet">
    <style>
        :root {
            --ion-color-primary: #3880ff;
            --ion-color-primary-rgb: 56, 128, 255;
            --ion-color-primary-contrast: #ffffff;
            --ion-color-primary-contrast-rgb: 255, 255, 255;
            --ion-color-primary-shade: #3171e0;
            --ion-color-primary-tint: #4c8dff;

            --ion-color-space: #10121e;
            --ion-color-space-rgb: 16, 18, 30;
            --ion-color-space-contrast: #ffffff;
            --ion-color-space-contrast-rgb: 255, 255, 255;
            --ion-color-space-shade: #0e101a;
            --ion-color-space-tint: #292b35;
        }

        .ion-color-space {
            --ion-color-base: var(--ion-color-space);
            --ion-color-base-rgb: var(--ion-color-space-rgb);
            --ion-color-contrast: var(--ion-color-space-contrast);
            --ion-color-contrast-rgb: var(--ion-color-space-contrast-rgb);
            --ion-color-shade: var(--ion-color-space-shade);
            --ion-color-tint: var(--ion-color-space-tint);
        }

        body {
            background-color: var(--ion-color-space);
        }

        .planet-canvas-container {
            width: 100%;
            height: 50vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        #solarSystemCanvas {
            background: transparent;
            border-radius: 8px;
            max-width: 100%;
            touch-action: none;
        }

        .planet-card {
            border-radius: 12px;
            margin: 10px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .planet-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 10px auto;
            display: block;
        }

        .info-chip {
            margin: 5px;
            --background: rgba(255, 255, 255, 0.1);
        }

        .canvas-controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            z-index: 10;
            display: flex;
            flex-direction: column;
        }

        .canvas-controls ion-button {
            margin: 5px;
            --border-radius: 50%;
            height: 40px;
            width: 40px;
        }

        .planet-detail-modal .planet-header {
            text-align: center;
            padding: 20px 0;
        }

        .planet-detail-modal .planet-img-large {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto;
            display: block;
        }

        .planet-detail-modal .info-grid {
            padding: 10px 20px;
        }

        .favorites-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 999;
        }

        .star-icon {
            color: #FFD700;
        }

        .location-chip {
            margin: 10px;
            --background: rgba(255, 255, 255, 0.1);
        }

        .location-container {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }

        .date-container {
            display: flex;
            justify-content: center;
            padding: 10px;
        }

        .date-display {
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 16px;
            color: white;
            display: flex;
            align-items: center;
        }

        .date-display ion-icon {
            margin-right: 5px;
        }

        .planet-visibility {
            font-size: 0.8em;
            margin-top: 5px;
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
        }

        .visible {
            background-color: rgba(0, 255, 0, 0.2);
            color: #9fff9f;
        }

        .not-visible {
            background-color: rgba(255, 0, 0, 0.2);
            color: #ff9f9f;
        }

        ion-content.content-space {
            --background: linear-gradient(135deg, var(--ion-color-space) 0%, #1a1f35 100%);
        }

        .planet-list {
            padding-bottom: 70px;
        }

        .planet-fact {
            margin: 10px 0;
            border-left: 2px solid var(--ion-color-primary);
            padding-left: 10px;
            font-style: italic;
        }

        /* Star background animation */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            opacity: 0.8;
            animation: twinkle 4s infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 0.8; }
        }
    </style>
</head>
<body>
    <ion-app>
        <!-- Hvězdné pozadí -->
        <div class="stars" id="stars"></div>

        <ion-tabs>
            <!-- Tab pro solární systém -->
            <ion-tab tab="solar-system">
                <ion-header translucent>
                    <ion-toolbar color="space">
                        <ion-title>Planetárium</ion-title>
                        <ion-buttons slot="end">
                            <ion-button id="date-picker-button">
                                <ion-icon name="calendar-outline" slot="icon-only"></ion-icon>
                            </ion-button>
                        </ion-buttons>
                    </ion-toolbar>
                </ion-header>

                <ion-content class="content-space">
                    <div class="date-container">
                        <div class="date-display">
                            <ion-icon name="time-outline"></ion-icon>
                            <span id="current-date">Aktuální datum</span>
                        </div>
                    </div>

                    <div class="location-container">
                        <ion-chip class="location-chip" id="location-chip">
                            <ion-icon name="location-outline"></ion-icon>
                            <ion-label id="location-text">Zjišťuji polohu...</ion-label>
                        </ion-chip>
                    </div>

                    <div class="planet-canvas-container">
                        <canvas id="solarSystemCanvas"></canvas>
                        <div class="canvas-controls">
                            <ion-button size="small" color="light" id="zoom-in-btn">
                                <ion-icon name="add-outline"></ion-icon>
                            </ion-button>
                            <ion-button size="small" color="light" id="zoom-out-btn">
                                <ion-icon name="remove-outline"></ion-icon>
                            </ion-button>
                            <ion-button size="small" color="light" id="reset-view-btn">
                                <ion-icon name="refresh-outline"></ion-icon>
                            </ion-button>
                        </div>
                    </div>

                    <div class="planet-list">
                        <ion-list id="planet-list">
                            <!-- Seznam planet bude dynamicky vytvořen JavaScriptem -->
                        </ion-list>
                    </div>
                </ion-content>
            </ion-tab>

            <!-- Tab pro oblíbené planety -->
            <ion-tab tab="favorites">
                <ion-header translucent>
                    <ion-toolbar color="space">
                        <ion-title>Oblíbené planety</ion-title>
                    </ion-toolbar>
                </ion-header>

                <ion-content class="content-space">
                    <ion-list id="favorites-list">
                        <!-- Seznam oblíbených planet bude dynamicky vytvořen JavaScriptem -->
                    </ion-list>
                </ion-content>
            </ion-tab>

            <!-- Tab s informacemi o aplikaci -->
            <ion-tab tab="about">
                <ion-header translucent>
                    <ion-toolbar color="space">
                        <ion-title>O aplikaci</ion-title>
                    </ion-toolbar>
                </ion-header>

                <ion-content class="content-space">
                    <ion-card class="planet-card">
                        <ion-card-header>
                            <ion-card-title>Planetárium</ion-card-title>
                            <ion-card-subtitle>Verze 1.0</ion-card-subtitle>
                        </ion-card-header>

                        <ion-card-content>
                            <p>Tato aplikace umožňuje prohlížet polohy planet sluneční soustavy a informace o nich. Získejte aktuální data o planetách, jejich vzdálenostech, velikostech a mnoha dalších zajímavých údajích.</p>

                            <div class="planet-fact">
                                "Slunce tvoří 99,86 % veškeré hmoty sluneční soustavy."
                            </div>

                            <h4>Funkce aplikace:</h4>
                            <ul>
                                <li>Interaktivní zobrazení sluneční soustavy</li>
                                <li>Detailní informace o každé planetě</li>
                                <li>Uložení oblíbených planet</li>
                                <li>Výpočet aktuální polohy planet dle datumu</li>
                                <li>Určení viditelnosti planet na základě vaší polohy</li>
                            </ul>

                            <h4>Zdroje dat:</h4>
                            <p>Aplikace využívá data z NASA Solar System Dynamics API a dalších astronomických databází.</p>
                        </ion-card-content>
                    </ion-card>
                </ion-content>
            </ion-tab>

            <!-- Tab bar na spodní části obrazovky -->
            <ion-tab-bar slot="bottom" color="space">
                <ion-tab-button tab="solar-system">
                    <ion-icon name="planet-outline"></ion-icon>
                    <ion-label>Sluneční soustava</ion-label>
                </ion-tab-button>

                <ion-tab-button tab="favorites">
                    <ion-icon name="star-outline"></ion-icon>
                    <ion-label>Oblíbené</ion-label>
                </ion-tab-button>

                <ion-tab-button tab="about">
                    <ion-icon name="information-circle-outline"></ion-icon>
                    <ion-label>O aplikaci</ion-label>
                </ion-tab-button>
            </ion-tab-bar>
        </ion-tabs>

        <!-- Modal pro detail planety -->
        <ion-modal trigger="open-planet-modal" id="planet-detail-modal" class="planet-detail-modal">
            <ion-header translucent>
                <ion-toolbar color="space">
                    <ion-title id="planet-detail-title">Detaily planety</ion-title>
                    <ion-buttons slot="end">
                        <ion-button onclick="dismissPlanetModal()">
                            <ion-icon name="close-outline"></ion-icon>
                        </ion-button>
                    </ion-buttons>
                    <ion-buttons slot="start">
                        <ion-button id="favorite-btn">
                            <ion-icon name="star-outline"></ion-icon>
                        </ion-button>
                    </ion-buttons>
                </ion-toolbar>
            </ion-header>
            <ion-content class="content-space">
                <div class="planet-header">
                    <img id="planet-detail-img" class="planet-img-large" src="" alt="Planeta">
                    <h2 id="planet-detail-name">Název planety</h2>
                    <p id="planet-detail-type">Typ planety</p>
                    <div id="planet-detail-visibility" class="planet-visibility">Viditelnost</div>
                </div>

                <ion-grid class="info-grid">
                    <ion-row>
                        <ion-col>
                            <ion-item>
                                <ion-label>
                                    <h3>Vzdálenost od Slunce</h3>
                                    <p id="planet-detail-distance">0 mil. km</p>
                                </ion-label>
                            </ion-item>
                        </ion-col>
                        <ion-col>
                            <ion-item>
                                <ion-label>
                                    <h3>Oběžná doba</h3>
                                    <p id="planet-detail-orbit">0 pozemských dní</p>
                                </ion-label>
                            </ion-item>
                        </ion-col>
                    </ion-row>
                    <ion-row>
                        <ion-col>
                            <ion-item>
                                <ion-label>
                                    <h3>Průměr</h3>
                                    <p id="planet-detail-diameter">0 km</p>
                                </ion-label>
                            </ion-item>
                        </ion-col>
                        <ion-col>
                            <ion-item>
                                <ion-label>
                                    <h3>Měsíce</h3>
                                    <p id="planet-detail-moons">0</p>
                                </ion-label>
                            </ion-item>
                        </ion-col>
                    </ion-row>
                    <ion-row>
                        <ion-col>
                            <ion-item>
                                <ion-label>
                                    <h3>Teplota</h3>
                                    <p id="planet-detail-temperature">0 °C</p>
                                </ion-label>
                            </ion-item>
                        </ion-col>
                        <ion-col>
                            <ion-item>
                                <ion-label>
                                    <h3>Doba rotace</h3>
                                    <p id="planet-detail-rotation">0 hodin</p>
                                </ion-label>
                            </ion-item>
                        </ion-col>
                    </ion-row>
                </ion-grid>

                <ion-card class="planet-card">
                    <ion-card-header>
                        <ion-card-title>Popis</ion-card-title>
                    </ion-card-header>
                    <ion-card-content id="planet-detail-description">
                        Popis planety...
                    </ion-card-content>
                </ion-card>

                <ion-card class="planet-card">
                    <ion-card-header>
                        <ion-card-title>Zajímavosti</ion-card-title>
                    </ion-card-header>
                    <ion-card-content id="planet-detail-facts">
                        <!-- Zajímavosti o planetě -->
                    </ion-card-content>
                </ion-card>
            </ion-content>
        </ion-modal>

        <!-- Výběr data -->
        <ion-modal trigger="date-picker-button">
            <ion-header>
                <ion-toolbar color="space">
                    <ion-title>Vyberte datum</ion-title>
                    <ion-buttons slot="end">
                        <ion-button onclick="this.closest('ion-modal').dismiss()">Zavřít</ion-button>
                    </ion-buttons>
                </ion-toolbar>
            </ion-header>
            <ion-content class="content-space">
                <ion-datetime id="date-picker" presentation="date"></ion-datetime>
                <ion-button expand="block" id="apply-date-btn" style="margin: 16px;">Aplikovat datum</ion-button>
            </ion-content>
        </ion-modal>
    </ion-app>

    <script>
        // Globální proměnné
        let scale = 1;
        let canvas, ctx;
        let offsetX = 0, offsetY = 0;
        let isDragging = false;
        let lastX, lastY;
        let selectedPlanet = null;
        let currentDate = new Date();
        let userLocation = null;
        const planetDetailModal = document.getElementById('planet-detail-modal');
        const planetListElement = document.getElementById('planet-list');
        const favoritesListElement = document.getElementById('favorites-list');
        
        // Data o planetách
        const planets = [
            {
                id: 'mercury',
                name: 'Merkur',
                type: 'Terestrická planeta',
                distanceFromSun: 57.9, // miliony km
                orbitalPeriod: 88, // dny
                diameter: 4879, // km
                moons: 0,
                temperature: { min: -173, max: 427 }, // °C
                rotationPeriod: 1408, // hodiny
                color: '#A9A9A9',
                orbitRadius: 30, // pro zobrazení na plátně
                orbitSpeed: 4.1, // relativní rychlost
                description: 'Merkur je nejmenší a nejbližší planeta ke Slunci. Je to skalnatá planeta s kráterovaným povrchem podobným Měsíci.',
                facts: [
                    'Den na Merkuru trvá 176 pozemských dní.',
                    'Merkur má velmi tenkou atmosféru složenou převážně z kyslíku, sodíku, vodíku, helia a draslíku.',
                    'Povrch Merkuru má rozdíl teplot až 600 °C mezi dnem a nocí.'
                ],
                visibility: function(date, location) {
                    // Simulovaný výpočet - ve skutečnosti by to bylo složitější
                    return Math.random() > 0.5 ? 'visible' : 'not-visible';
                }
            },
            {
                id: 'venus',
                name: 'Venuše',
                type: 'Terestrická planeta',
                distanceFromSun: 108.2,
                orbitalPeriod: 225,
                diameter: 12104,
                moons: 0,
                temperature: { min: 462, max: 462 },
                rotationPeriod: 5832,
                color: '#E6E6FA',
                orbitRadius: 50,
                orbitSpeed: 1.6,
                description: 'Venuše je druhá planeta od Slunce a je pojmenována po římské bohyni lásky a krásy. Je to horká planeta s tlustou atmosférou tvořenou převážně oxidem uhličitým.',
                facts: [
                    'Venuše je nejjasnější objekt na obloze po Slunci a Měsíci.',
                    'Venuše rotuje kolem své osy opačným směrem než většina ostatních planet.',
                    'Atmosférický tlak na povrchu Venuše je 92 krát větší než na Zemi.'
                ],
                visibility: function(date, location) {
                    const month = date.getMonth();
                    return (month >= 3 && month <= 8) ? 'visible' : 'not-visible';
                }
            },
            {
                id: 'earth',
                name: 'Země',
                type: 'Terestrická planeta',
                distanceFromSun: 149.6,
                orbitalPeriod: 365.2,
                diameter: 12756,
                moons: 1,
                temperature: { min: -88, max: 58 },
                rotationPeriod: 24,
                color: '#1E90FF',
                orbitRadius: 70,
                orbitSpeed: 1,
                description: 'Země je třetí planeta od Slunce a jediná známá planeta, na které existuje život. Má jeden přirozený satelit - Měsíc.',
                facts: [
                    'Země je jediná planeta, která není pojmenována po bohu nebo bohyni.',
                    'Gravitační pole Země vytváří magnetosféru, která chrání planetu před slunečním větrem.',
                    'Zhruba 71% povrchu Země pokrývá voda.'
                ],
                visibility: function(date, location) {
                    return 'visible'; // Žijeme na Zemi, takže ji "vidíme" vždy
                }
            },
            {
                id: 'mars',
                name: 'Mars',
                type: 'Terestrická planeta',
                distanceFromSun: 227.9,
                orbitalPeriod: 687,
                diameter: 6792,
                moons: 2,
                temperature: { min: -153, max: 20 },
                rotationPeriod: 25,
                color: '#CD5C5C',
                orbitRadius: 90,
                orbitSpeed: 0.5,
                description: 'Mars je čtvrtá planeta od Slunce a druhá nejmenší planeta naší sluneční soustavy. Je často označován jako "rudá planeta" kvůli oxidovanému železu na jeho povrchu.',
                facts: [
                    'Mars má nejvyšší horu ve sluneční soustavě - Olympus Mons je vysoká 21 km.',
                    'Mars má dva měsíce - Phobos a Deimos - které jsou nepravidelného tvaru.',
                    'Gravtiace na Marsu je asi 38% gravitace Země.'
                ],
                visibility: function(date, location) {
                    const day = date.getDate();
                    return day % 2 === 0 ? 'visible' : 'not-visible';
                }
            },
            {
                id: 'jupiter',
                name: 'Jupiter',
                type: 'Plynný obr',
                distanceFromSun: 778.5,
                orbitalPeriod: 4333,
                diameter: 142984,
                moons: 79,
                temperature: { min: -145, max: -145 },
                rotationPeriod: 10,
                color: '#F4A460',
                orbitRadius: 130,
                orbitSpeed: 0.08,
                description: 'Jupiter je pátá planeta od Slunce a zároveň největší planeta sluneční soustavy. Je to plynný obr s bouřlivou atmosférou.',
                facts: [
                    'Jupiter má Velkou rudou skvrnu - obrovskou bouři, která existuje již nejméně 400 let.',
                    'Jupiter má slabý prstencový systém, který byl objeven v roce 1979.',
                    'Jupiter spotřebuje více než dvakrát tolik hmoty jako všechny ostatní planety dohromady.'
                ],
                visibility: function(date, location) {
                    return date.getFullYear() % 2 === 0 ? 'visible' : 'not-visible';
                }
            },
            {
                id: 'saturn',
                name: 'Saturn',
                type: 'Plynný obr',
                distanceFromSun: 1434,
                orbitalPeriod: 10759,
                diameter: 120536,
                moons: 82,
                temperature: { min: -178, max: -178 },
                rotationPeriod: 11,
                color: '#FFD700',
                orbitRadius: 170,
                orbitSpeed: 0.03,
                description: 'Saturn je šestá planeta od Slunce a druhá největší v naší sluneční soustavě. Je známý svými nápadnými prstenci, které jsou složeny převážně z ledových částic.',
                facts: [
                    'Saturnovy prstence sahají do vzdálenosti 282 000 km od planety, ale jejich tloušťka je menší než 1 km.',
                    'Saturn má nejnižší hustotu ze všech planet - je dokonce méně hustý než voda.',
                    'Den na Saturnu trvá jen asi 10,7 hodin.'
                ],
                visibility: function(date, location) {
                    const month = date.getMonth();
                    return (month >= 6 && month <= 11) ? 'visible' : 'not-visible';
                }
            },
            {
                id: 'uranus',
                name: 'Uran',
                type: 'Ledový obr',
                distanceFromSun: 2871,
                orbitalPeriod: 30687,
                diameter: 51118,
                moons: 27,
                temperature: { min: -224, max: -224 },
                rotationPeriod: 17,
                color: '#00FFFF',
                orbitRadius: 210,
                orbitSpeed: 0.01,
                description: 'Uran je sedmá planeta od Slunce a třetí největší planeta naší sluneční soustavy. Je to ledový obr s atmosférou složenou hlavně z vodíku, helia a metanu.',
                facts: [
                    'Uran je jediný plynný obr, který rotuje na boku - jeho rotační osa je skloněna o téměř 98 stupňů.',
                    'Uran byl první planetou, která byla objevena pomocí teleskopu v roce 1781.',
                    'Uran má 13 známých prstenců, které jsou velmi tmavé a tenké.'
                ],
                visibility: function(date, location) {
                    return Math.random() > 0.7 ? 'visible' : 'not-visible';
                }
            },
            {
                id: 'neptune',
                name: 'Neptun',
                type: 'Ledový obr',
                distanceFromSun: 4495,
                orbitalPeriod: 60190,
                diameter: 49528,
                moons: 14,
                temperature: { min: -218, max: -218 },
                rotationPeriod: 16,
                color: '#4169E1',
                orbitRadius: 250,
                orbitSpeed: 0.006,
                description: 'Neptun je osmá a nejvzdálenější planeta naší sluneční soustavy. Je to ledový obr, který má atmosféru složenou hlavně z vodíku, helia a metanu.',
                facts: [
                    'Neptun má nejsilnější větry v celé sluneční soustavě - mohou dosahovat rychlosti až 2 100 km/h.',
                    'Neptun byl objeven matematickými výpočty, nikoli přímým pozorováním.',
                    'Neptun má systém prstenců, který je velmi tmavý a obtížně pozorovatelný.'
                ],
                visibility: function(date, location) {
                    return Math.random() > 0.8 ? 'visible' : 'not-visible';
                }
            }
        ];

        // Inicializace aplikace
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            initializeCanvas();
            createStarBackground();
            updateCurrentDateDisplay();
            loadFavorites();

            document.getElementById('zoom-in-btn').addEventListener('click', zoomIn);
            document.getElementById('zoom-out-btn').addEventListener('click', zoomOut);
            document.getElementById('reset-view-btn').addEventListener('click', resetView);
            document.getElementById('apply-date-btn').addEventListener('click', applySelectedDate);
            document.getElementById('favorite-btn').addEventListener('click', toggleFavorite);

            // Nastavení event listenerů pro modaly
            const datePickerBtn = document.getElementById('date-picker-button');
            datePickerBtn.addEventListener('click', () => {
                document.getElementById('date-picker').value = currentDate.toISOString();
            });

            // Získání geolokace
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        userLocation = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        };
                        updateLocationDisplay();
                        updatePlanetVisibility();
                    },
                    error => {
                        console.error("Nepodařilo se získat polohu: ", error);
                        document.getElementById('location-text').textContent = 'Poloha není dostupná';
                    }
                );
            } else {
                document.getElementById('location-text').textContent = 'Geolokace není podporována';
            }

            // Načtení dat o planetách ze serveru
            fetchPlanetData();
        });

        // Funkce pro inicializaci aplikace
        function initializeApp() {
            renderPlanetList();
        }

        // Funkce pro inicializaci plátna pro vykreslení solární soustavy
        function initializeCanvas() {
            canvas = document.getElementById('solarSystemCanvas');
            ctx = canvas.getContext('2d');
            
            // Nastavení velikosti plátna
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Event listenery pro manipulaci s plátnem
            canvas.addEventListener('mousedown', startDrag);
            canvas.addEventListener('mousemove', drag);
            canvas.addEventListener('mouseup', endDrag);
            canvas.addEventListener('mouseout', endDrag);
            
            // Dotykové ovládání
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', handleTouchEnd);
            
            // Animace plátna
            requestAnimationFrame(animateCanvas);
        }

        // Funkce pro změnu velikosti plátna
        function resizeCanvas() {
            const container = document.querySelector('.planet-canvas-container');
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
            drawSolarSystem();
        }

        // Funkce pro vykreslení sluneční soustavy na plátno
        function drawSolarSystem() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const centerX = canvas.width / 2 + offsetX;
            const centerY = canvas.height / 2 + offsetY;
            
            // Vykreslení Slunce
            ctx.beginPath();
            ctx.arc(centerX, centerY, 15 * scale, 0, Math.PI * 2);
            const gradient = ctx.createRadialGradient(
                centerX, centerY, 0,
                centerX, centerY, 15 * scale
            );
            gradient.addColorStop(0, '#FFFF00');
            gradient.addColorStop(1, '#FFA500');
            ctx.fillStyle = gradient;
            ctx.fill();
            
            // Vykreslení oběžných drah
            planets.forEach(planet => {
                ctx.beginPath();
                ctx.arc(centerX, centerY, planet.orbitRadius * scale, 0, Math.PI * 2);
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.stroke();
            });
            
            // Výpočet pozic planet na základě aktuálního data
            const now = currentDate;
            const startOfYear = new Date(now.getFullYear(), 0, 1);
            const dayOfYear = Math.floor((now - startOfYear) / (24 * 60 * 60 * 1000));
            
            // Vykreslení planet
            planets.forEach(planet => {
                // Výpočet pozice na oběžné dráze
                const angle = (dayOfYear * planet.orbitSpeed) % 360;
                const radians = angle * Math.PI / 180;
                const x = centerX + Math.cos(radians) * planet.orbitRadius * scale;
                const y = centerY + Math.sin(radians) * planet.orbitRadius * scale;
                
                // Vykreslení planety
                ctx.beginPath();
                const planetSize = planet.diameter / 20000 * scale;
                const size = Math.max(3 * scale, planetSize);
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fillStyle = planet.color;
                ctx.fill();
                
                // Uchování pozice pro detekci kliknutí
                planet.screenX = x;
                planet.screenY = y;
                planet.screenRadius = size;
            });
        }

        // Animace plátna
        function animateCanvas() {
            drawSolarSystem();
            requestAnimationFrame(animateCanvas);
        }

        // Funkce pro manipulaci s plátnem
        function startDrag(e) {
            const rect = canvas.getBoundingClientRect();
            lastX = e.clientX - rect.left;
            lastY = e.clientY - rect.top;
            isDragging = true;
            
            // Kontrola, zda bylo kliknuto na planetu
            checkPlanetClick(lastX, lastY);
        }

        function drag(e) {
            if (isDragging) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                offsetX += (x - lastX) / scale;
                offsetY += (y - lastY) / scale;
                
                lastX = x;
                lastY = y;
            }
        }

        function endDrag() {
            isDragging = false;
        }

        // Funkce pro dotykové ovládání
        function handleTouchStart(e) {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            lastX = e.touches[0].clientX - rect.left;
            lastY = e.touches[0].clientY - rect.top;
            isDragging = true;
            
            // Kontrola, zda bylo kliknuto na planetu
            checkPlanetClick(lastX, lastY);
        }

        function handleTouchMove(e) {
            if (isDragging) {
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                const x = e.touches[0].clientX - rect.left;
                const y = e.touches[0].clientY - rect.top;
                
                offsetX += (x - lastX) / scale;
                offsetY += (y - lastY) / scale;
                
                lastX = x;
                lastY = y;
            }
        }

        function handleTouchEnd(e) {
            isDragging = false;
        }

        // Funkce pro přiblížení/oddálení
        function zoomIn() {
            scale *= 1.2;
        }

        function zoomOut() {
            scale /= 1.2;
        }

        function resetView() {
            scale = 1;
            offsetX = 0;
            offsetY = 0;
        }

        // Funkce pro kontrolu kliknutí na planetu
        function checkPlanetClick(x, y) {
            for (let i = planets.length - 1; i >= 0; i--) {
                const planet = planets[i];
                const dx = x - planet.screenX;
                const dy = y - planet.screenY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance <= planet.screenRadius) {
                    selectedPlanet = planet;
                    openPlanetDetail(planet);
                    break;
                }
            }
        }

        // Funkce pro vytvoření hvězdného pozadí
        function createStarBackground() {
            const starsElement = document.getElementById('stars');
            const starCount = 150;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                // Náhodné umístění hvězdy
                const x = Math.floor(Math.random() * 100);
                const y = Math.floor(Math.random() * 100);
                
                // Náhodná velikost hvězdy
                const size = Math.random() * 3;
                
                // Náhodný čas animace
                const delay = Math.random() * 4;
                
                star.style.left = `${x}%`;
                star.style.top = `${y}%`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.animationDelay = `${delay}s`;
                
                starsElement.appendChild(star);
            }
        }

        // Funkce pro aktualizaci zobrazení aktuálního data
        function updateCurrentDateDisplay() {
            const dateStr = currentDate.toLocaleDateString('cs-CZ', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('current-date').textContent = dateStr;
            updatePlanetVisibility();
        }

        // Funkce pro aktualizaci polohy
        function updateLocationDisplay() {
            if (userLocation) {
                document.getElementById('location-text').textContent = 
                    `${userLocation.latitude.toFixed(2)}°, ${userLocation.longitude.toFixed(2)}°`;
            }
        }

        // Funkce pro vykreslení seznamu planet
        function renderPlanetList() {
            planetListElement.innerHTML = '';
            
            planets.forEach(planet => {
                const isVisible = planet.visibility(currentDate, userLocation) === 'visible';
                const visibilityClass = isVisible ? 'visible' : 'not-visible';
                const visibilityText = isVisible ? 'Viditelná' : 'Neviditelná';
                
                const planetItem = document.createElement('ion-item');
                planetItem.classList.add('planet-card');
                planetItem.style.setProperty('--background', 'rgba(255, 255, 255, 0.05)');
                planetItem.style.borderRadius = '12px';
                planetItem.style.margin = '8px';
                
                planetItem.innerHTML = `
                    <div style="display: flex; width: 100%; align-items: center;">
                        <div style="width: 60px; height: 60px; background-color: ${planet.color}; border-radius: 50%; margin-right: 16px;"></div>
                        <ion-label>
                            <h2>${planet.name}</h2>
                            <p>${planet.type}</p>
                            <div class="planet-visibility ${visibilityClass}">${visibilityText}</div>
                        </ion-label>
                        <ion-chip class="info-chip">
                            <ion-label>${planet.distanceFromSun} mil. km</ion-label>
                        </ion-chip>
                    </div>
                `;
                
                planetItem.addEventListener('click', () => {
                    openPlanetDetail(planet);
                });
                
                planetListElement.appendChild(planetItem);
            });
        }

        // Funkce pro aktualizaci viditelnosti planet
        function updatePlanetVisibility() {
            renderPlanetList();
            renderFavoritesList();
        }

        // Funkce pro otevření detailu planety
        function openPlanetDetail(planet) {
            selectedPlanet = planet;
            
            // Nastavení údajů o planetě v modalu
            document.getElementById('planet-detail-title').textContent = planet.name;
            document.getElementById('planet-detail-name').textContent = planet.name;
            document.getElementById('planet-detail-type').textContent = planet.type;
            document.getElementById('planet-detail-img').style.backgroundColor = planet.color;
            document.getElementById('planet-detail-distance').textContent = `${planet.distanceFromSun} mil. km`;
            document.getElementById('planet-detail-orbit').textContent = `${planet.orbitalPeriod} dní`;
            document.getElementById('planet-detail-diameter').textContent = `${planet.diameter} km`;
            document.getElementById('planet-detail-moons').textContent = planet.moons;
            document.getElementById('planet-detail-temperature').textContent = 
                `${planet.temperature.min} až ${planet.temperature.max} °C`;
            document.getElementById('planet-detail-rotation').textContent = `${planet.rotationPeriod} hodin`;
            document.getElementById('planet-detail-description').textContent = planet.description;
            
            // Viditelnost planety
            const isVisible = planet.visibility(currentDate, userLocation) === 'visible';
            const visibilityElement = document.getElementById('planet-detail-visibility');
            visibilityElement.textContent = isVisible ? 'Viditelná' : 'Neviditelná';
            visibilityElement.className = `planet-visibility ${isVisible ? 'visible' : 'not-visible'}`;
            
            // Zajímavosti o planetě
            const factsContainer = document.getElementById('planet-detail-facts');
            factsContainer.innerHTML = '';
            planet.facts.forEach(fact => {
                const factElement = document.createElement('div');
                factElement.className = 'planet-fact';
                factElement.textContent = fact;
                factsContainer.appendChild(factElement);
            });
            
            // Ikona oblíbených
            updateFavoriteButton();
            
            // Otevření modalu
            planetDetailModal.present();
        }

        // Funkce pro zavření detailu planety
        function dismissPlanetModal() {
            planetDetailModal.dismiss();
        }

        // Funkce pro nastavení vybraného data
        function applySelectedDate() {
            const datePicker = document.getElementById('date-picker');
            currentDate = new Date(datePicker.value);
            updateCurrentDateDisplay();
            document.querySelector('ion-modal[trigger="date-picker-button"]').dismiss();
        }

        // Funkce pro přidání/odebrání planety z oblíbených
        function toggleFavorite() {
            if (!selectedPlanet) return;
            
            let favorites = JSON.parse(localStorage.getItem('favoritePlanets')) || [];
            
            const index = favorites.findIndex(id => id === selectedPlanet.id);
            if (index === -1) {
                favorites.push(selectedPlanet.id);
            } else {
                favorites.splice(index, 1);
            }
            
            localStorage.setItem('favoritePlanets', JSON.stringify(favorites));
            updateFavoriteButton();
            renderFavoritesList();
        }

        // Funkce pro aktualizaci tlačítka pro oblíbené
        function updateFavoriteButton() {
            if (!selectedPlanet) return;
            
            const favorites = JSON.parse(localStorage.getItem('favoritePlanets')) || [];
            const isFavorite = favorites.includes(selectedPlanet.id);
            
            const favoriteBtn = document.getElementById('favorite-btn');
            favoriteBtn.innerHTML = isFavorite 
                ? '<ion-icon name="star" class="star-icon"></ion-icon>' 
                : '<ion-icon name="star-outline"></ion-icon>';
        }

        // Funkce pro načtení oblíbených planet
        function loadFavorites() {
            renderFavoritesList();
        }

        // Funkce pro vykreslení seznamu oblíbených planet
        function renderFavoritesList() {
            const favorites = JSON.parse(localStorage.getItem('favoritePlanets')) || [];
            favoritesListElement.innerHTML = '';
            
            if (favorites.length === 0) {
                const emptyItem = document.createElement('ion-item');
                emptyItem.innerHTML = `
                    <ion-label class="ion-text-center">
                        <p>Nemáte žádné oblíbené planety</p>
                        <p>Přidejte si oblíbené planety kliknutím na hvězdičku v detailu planety</p>
                    </ion-label>
                `;
                favoritesListElement.appendChild(emptyItem);
                return;
            }
            
            favorites.forEach(id => {
                const planet = planets.find(p => p.id === id);
                if (!planet) return;
                
                const isVisible = planet.visibility(currentDate, userLocation) === 'visible';
                const visibilityClass = isVisible ? 'visible' : 'not-visible';
                const visibilityText = isVisible ? 'Viditelná' : 'Neviditelná';
                
                const planetItem = document.createElement('ion-item');
                planetItem.classList.add('planet-card');
                planetItem.style.setProperty('--background', 'rgba(255, 255, 255, 0.05)');
                planetItem.style.borderRadius = '12px';
                planetItem.style.margin = '8px';
                
                planetItem.innerHTML = `
                    <div style="display: flex; width: 100%; align-items: center;">
                        <div style="width: 60px; height: 60px; background-color: ${planet.color}; border-radius: 50%; margin-right: 16px;"></div>
                        <ion-label>
                            <h2>${planet.name}</h2>
                            <p>${planet.type}</p>
                            <div class="planet-visibility ${visibilityClass}">${visibilityText}</div>
                        </ion-label>
                        <ion-button fill="clear" class="remove-favorite-btn">
                            <ion-icon name="close-circle-outline" slot="icon-only"></ion-icon>
                        </ion-button>
                    </div>
                `;
                
                planetItem.addEventListener('click', (e) => {
                    // Pokud nebylo kliknuto na tlačítko pro odebrání
                    if (!e.target.closest('.remove-favorite-btn')) {
                        openPlanetDetail(planet);
                    }
                });
                
                // Přidání event listeneru pro odebrání z oblíbených
                const removeBtn = planetItem.querySelector('.remove-favorite-btn');
                removeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    let favorites = JSON.parse(localStorage.getItem('favoritePlanets')) || [];
                    const index = favorites.indexOf(planet.id);
                    if (index !== -1) {
                        favorites.splice(index, 1);
                        localStorage.setItem('favoritePlanets', JSON.stringify(favorites));
                        renderFavoritesList();
                        
                        // Aktualizace tlačítka, pokud je otevřený detail této planety
                        if (selectedPlanet && selectedPlanet.id === planet.id) {
                            updateFavoriteButton();
                        }
                    }
                });
                
                favoritesListElement.appendChild(planetItem);
            });
        }

        // Funkce pro načtení dat o planetách ze serveru
        async function fetchPlanetData() {
            try {
                // Ukázka použití AJAX pro získání dat
                const response = await fetch('https://api.le-systeme-solaire.net/rest/bodies/');
                const data = await response.json();
                
                // Aktualizace dat o planetách z API
                if (data && data.bodies) {
                    // Filtrujeme pouze planety sluneční soustavy
                    const apiPlanets = data.bodies.filter(body => 
                        body.isPlanet && body.englishName
                    );
                    
                    // Aktualizace některých dat o planetách
                    apiPlanets.forEach(apiPlanet => {
                        const planet = planets.find(p => 
                            p.name.toLowerCase() === apiPlanet.name.toLowerCase() || 
                            p.name.toLowerCase() === apiPlanet.englishName.toLowerCase()
                        );
                        
                        if (planet) {
                            // Aktualizace dat, která jsou dostupná z API
                            if (apiPlanet.meanRadius) {
                                planet.diameter = Math.round(apiPlanet.meanRadius * 2);
                            }
                            if (apiPlanet.sideralOrbit) {
                                planet.orbitalPeriod = Math.round(apiPlanet.sideralOrbit);
                            }
                            if (apiPlanet.moons) {
                                planet.moons = apiPlanet.moons ? apiPlanet.moons.length : 0;
                            }
                        }
                    });
                    
                    // Aktualizace UI
                    renderPlanetList();
                }
            } catch (error) {
                console.error("Chyba při načítání dat o planetách:", error);
                
                // Zobrazení chybové hlášky uživateli
                const alert = document.createElement('ion-alert');
                alert.header = 'Chyba při načítání dat';
                alert.message = 'Nepodařilo se načíst aktuální data o planetách. Aplikace používá offline data.';
                alert.buttons = ['OK'];
                document.body.appendChild(alert);
                alert.present();
            }
        }
    </script>
</body>
</html>