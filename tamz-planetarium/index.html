<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planetárium</title>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js"></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css" rel="stylesheet">
    <style>
        :root {
            --ion-background-color: #121212;
            --ion-text-color: #ffffff;
            --ion-tab-bar-background: #1a1a1a;
            --ion-tab-bar-color: #8c8c8c;
            --ion-tab-bar-color-selected: #ffffff;
        }

        .space-bg {
            background: linear-gradient(to bottom, #000000, #141e30);
        }

        .planet-card {
            background: rgba(25, 25, 35, 0.8);
            border-radius: 12px;
            margin: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 20, 0.5);
            overflow: hidden;
        }

        .planet-card ion-card-header {
            background: rgba(30, 30, 45, 0.5);
        }

        .planet-item {
            --background: rgba(30, 30, 45, 0.5);
            --border-radius: 8px;
            margin-bottom: 8px;
        }

        .planet-title {
            font-size: 1.4rem;
            font-weight: bold;
        }

        .planet-subtitle {
            color: #b8b8b8;
        }

        .planet-img {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
        }

        .planet-detail-img {
            width: 150px;
            height: 150px;
            margin: 0 auto;
            display: block;
        }

        .planet-orbit {
            position: relative;
            width: 100%;
            height: 300px;
            margin: 30px 0;
        }

        .sun {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle at center, #fff200, #ff7700);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px 5px rgba(255, 255, 0, 0.5);
            z-index: 10;
        }

        .orbit-path {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
        }

        .planet-marker {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.3);
            z-index: 5;
        }

        .planet-name {
            position: absolute;
            font-size: 10px;
            color: #ffffff;
            transform: translate(-50%, -50%);
        }

        .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 15;
            --padding-start: 5px;
            --padding-end: 5px;
            --padding-top: 5px;
            --padding-bottom: 5px;
            --border-radius: 50%;
        }

        .data-source {
            font-size: 0.7rem;
            color: #666666;
            text-align: center;
            margin-top: 10px;
        }

        .mercury { background-color: #b5b5b5; }
        .venus { background-color: #e6a57a; }
        .earth { background-color: #5992ca; }
        .mars { background-color: #c75d35; }
        .jupiter { background-color: #e0ae6f; }
        .saturn { background-color: #f9e07f; }
        .uranus { background-color: #9bd8df; }
        .neptune { background-color: #3b66d4; }

        .loading-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        .detail-table {
            margin-top: 20px;
        }

        .detail-table ion-item {
            --background: rgba(30, 30, 45, 0.3);
            --border-color: rgba(60, 60, 75, 0.5);
        }

        .favorites-icon {
            padding-left: 10px;
            color: #ffc409;
        }

        .settings-section {
            margin: 20px 0;
        }
    </style>
</head>
<body>
<ion-app>
    <!-- Menu -->
    <ion-menu side="start" content-id="main-content">
        <ion-header>
            <ion-toolbar>
                <ion-title>Menu</ion-title>
            </ion-toolbar>
        </ion-header>
        <ion-content>
            <ion-list>
                <ion-item button onclick="navigateTo('planets')">
                    <ion-icon name="planet-outline" slot="start"></ion-icon>
                    <ion-label>Planety</ion-label>
                </ion-item>
                <ion-item button onclick="navigateTo('favorites')">
                    <ion-icon name="star-outline" slot="start"></ion-icon>
                    <ion-label>Oblíbené</ion-label>
                </ion-item>
                <ion-item button onclick="navigateTo('map')">
                    <ion-icon name="map-outline" slot="start"></ion-icon>
                    <ion-label>Mapa vesmíru</ion-label>
                </ion-item>
                <ion-item button onclick="navigateTo('settings')">
                    <ion-icon name="settings-outline" slot="start"></ion-icon>
                    <ion-label>Nastavení</ion-label>
                </ion-item>
                <ion-item button onclick="showAboutModal()">
                    <ion-icon name="information-circle-outline" slot="start"></ion-icon>
                    <ion-label>O aplikaci</ion-label>
                </ion-item>
            </ion-list>
        </ion-content>
    </ion-menu>

    <!-- Hlavní obsah -->
    <div class="ion-page" id="main-content">
        <ion-header>
            <ion-toolbar>
                <ion-buttons slot="start">
                    <ion-menu-button></ion-menu-button>
                </ion-buttons>
                <ion-title id="page-title">Planetárium</ion-title>
                <ion-buttons slot="end">
                    <ion-button onclick="refreshData()">
                        <ion-icon slot="icon-only" name="refresh-outline"></ion-icon>
                    </ion-button>
                </ion-buttons>
            </ion-toolbar>
            <ion-toolbar id="search-toolbar" style="display: none;">
                <ion-searchbar id="planet-search" placeholder="Hledat planetu" animated></ion-searchbar>
            </ion-toolbar>
        </ion-header>

        <!-- Obsah stránky -->
        <ion-content class="space-bg">
            <!-- Zobrazení seznamu planet -->
            <div id="planets-page">
                <ion-refresher slot="fixed" id="planets-refresher">
                    <ion-refresher-content pulling-icon="chevron-down-circle-outline" refreshing-spinner="circles"></ion-refresher-content>
                </ion-refresher>

                <div class="planet-orbit">
                    <div class="sun"></div>
                    <!-- Orbity planet se vytvoří dynamicky -->
                </div>

                <ion-list id="planet-list">
                    <!-- Seznam planet se načte dynamicky -->
                    <ion-item class="loading-container">
                        <ion-spinner name="crescent"></ion-spinner>
                        <ion-label class="ion-text-center">Načítání planet...</ion-label>
                    </ion-item>
                </ion-list>

                <div class="data-source">
                    Data poskytuje Solar System OpenData API
                </div>
            </div>

            <!-- Detail planety -->
            <div id="planet-detail" style="display: none;">
                <ion-card class="planet-card">
                    <img id="detail-img" class="planet-detail-img" src="" alt="Obrázek planety">
                    <ion-card-header>
                        <ion-card-subtitle id="detail-subtitle" class="planet-subtitle"></ion-card-subtitle>
                        <ion-card-title id="detail-title" class="planet-title"></ion-card-title>
                    </ion-card-header>
                    <ion-card-content>
                        <p id="detail-description"></p>

                        <ion-list class="detail-table">
                            <ion-item>
                                <ion-label>Průměr</ion-label>
                                <ion-note slot="end" id="detail-diameter"></ion-note>
                            </ion-item>
                            <ion-item>
                                <ion-label>Vzdálenost od Slunce</ion-label>
                                <ion-note slot="end" id="detail-distance"></ion-note>
                            </ion-item>
                            <ion-item>
                                <ion-label>Oběžná doba</ion-label>
                                <ion-note slot="end" id="detail-orbit-period"></ion-note>
                            </ion-item>
                            <ion-item>
                                <ion-label>Rotační doba</ion-label>
                                <ion-note slot="end" id="detail-rotation-period"></ion-note>
                            </ion-item>
                            <ion-item>
                                <ion-label>Teplota</ion-label>
                                <ion-note slot="end" id="detail-temperature"></ion-note>
                            </ion-item>
                            <ion-item>
                                <ion-label>Počet měsíců</ion-label>
                                <ion-note slot="end" id="detail-moons"></ion-note>
                            </ion-item>
                        </ion-list>

                        <ion-button expand="full" color="primary" id="favorite-button" class="ion-margin-top">
                            <ion-icon name="star-outline" slot="start"></ion-icon>
                            Přidat do oblíbených
                        </ion-button>
                    </ion-card-content>
                </ion-card>
            </div>

            <!-- Oblíbené planety -->
            <div id="favorites-page" style="display: none;">
                <ion-list id="favorites-list">
                    <ion-list-header>
                        <ion-label>Vaše oblíbené planety</ion-label>
                    </ion-list-header>
                    <!-- Seznam oblíbených planet se načte dynamicky -->
                </ion-list>
            </div>

            <!-- Mapa vesmíru -->
            <div id="map-page" style="display: none;">
                <canvas id="solar-system-canvas" width="400" height="400"></canvas>
                <div class="ion-padding">
                    <ion-item lines="none">
                        <ion-range min="0" max="360" value="0" pin="true" id="rotation-slider">
                            <ion-icon slot="start" name="sync-outline"></ion-icon>
                            <ion-icon slot="end" name="sync"></ion-icon>
                        </ion-range>
                    </ion-item>
                    <ion-label class="ion-text-center">Otáčejte sluneční soustavou</ion-label>
                </div>
            </div>

            <!-- Nastavení -->
            <div id="settings-page" style="display: none;">
                <ion-list>
                    <ion-list-header>
                        <ion-label>Nastavení aplikace</ion-label>
                    </ion-list-header>

                    <ion-item class="settings-section">
                        <ion-label>Temný režim</ion-label>
                        <ion-toggle id="dark-mode-toggle" checked></ion-toggle>
                    </ion-item>

                    <ion-item>
                        <ion-label>Jednotky vzdálenosti</ion-label>
                        <ion-select id="distance-units">
                            <ion-select-option value="km">Kilometry</ion-select-option>
                            <ion-select-option value="au">AU</ion-select-option>
                        </ion-select>
                    </ion-item>

                    <ion-item>
                        <ion-label>Jednotky teploty</ion-label>
                        <ion-select id="temperature-units">
                            <ion-select-option value="celsius">Celsius</ion-select-option>
                            <ion-select-option value="fahrenheit">Fahrenheit</ion-select-option>
                            <ion-select-option value="kelvin">Kelvin</ion-select-option>
                        </ion-select>
                    </ion-item>

                    <ion-item>
                        <ion-label>Animace</ion-label>
                        <ion-toggle id="animations-toggle" checked></ion-toggle>
                    </ion-item>

                    <ion-item lines="none">
                        <ion-button expand="block" color="danger" fill="outline" id="clear-data-button" class="ion-margin-top">
                            Vymazat uložená data
                        </ion-button>
                    </ion-item>
                </ion-list>
            </div>
        </ion-content>

        <!-- Tab menu -->
        <ion-tab-bar slot="bottom">
            <ion-tab-button tab="planets" onclick="navigateTo('planets')">
                <ion-icon name="planet-outline"></ion-icon>
                <ion-label>Planety</ion-label>
            </ion-tab-button>
            <ion-tab-button tab="favorites" onclick="navigateTo('favorites')">
                <ion-icon name="star-outline"></ion-icon>
                <ion-label>Oblíbené</ion-label>
            </ion-tab-button>
            <ion-tab-button tab="map" onclick="navigateTo('map')">
                <ion-icon name="map-outline"></ion-icon>
                <ion-label>Mapa</ion-label>
            </ion-tab-button>
            <ion-tab-button tab="settings" onclick="navigateTo('settings')">
                <ion-icon name="settings-outline"></ion-icon>
                <ion-label>Nastavení</ion-label>
            </ion-tab-button>
        </ion-tab-bar>
    </div>

    <!-- Modal o aplikaci -->
    <ion-modal id="about-modal">
        <ion-header>
            <ion-toolbar>
                <ion-title>O aplikaci</ion-title>
                <ion-buttons slot="end">
                    <ion-button onclick="dismissAboutModal()">Zavřít</ion-button>
                </ion-buttons>
            </ion-toolbar>
        </ion-header>
        <ion-content class="ion-padding">
            <div class="ion-text-center">
                <h2>Planetárium</h2>
                <p>Verze 1.0.0</p>
                <p>Aplikace pro zobrazení informací o planetách sluneční soustavy</p>
                <p>Vytvořeno pomocí Ionic Frameworku</p>
            </div>
        </ion-content>
    </ion-modal>
</ion-app>

<script>
    class PlanetData {
        constructor() {
            this.planets = [];
            this.favorites = this.loadFavorites();
            this.settings = this.loadSettings();
        }

        async fetchData() {
            try {
                const response = await fetch('https://api.le-systeme-solaire.net/rest/bodies?filter[]=isPlanet,eq,true');
                const data = await response.json();
                this.planets = data.bodies.sort((a, b) => a.semimajorAxis - b.semimajorAxis);
                return this.planets;
            } catch (error) {
                console.error('Chyba při načítání dat:', error);
                return [];
            }
        }

        getPlanetById(id) {
            return this.planets.find(planet => planet.id === id);
        }

        toggleFavorite(planetId) {
            const index = this.favorites.indexOf(planetId);
            if (index === -1) {
                this.favorites.push(planetId);
            } else {
                this.favorites.splice(index, 1);
            }
            this.saveFavorites();
            return index === -1;
        }

        isFavorite(planetId) {
            return this.favorites.includes(planetId);
        }

        saveFavorites() {
            localStorage.setItem('planetarium-favorites', JSON.stringify(this.favorites));
        }

        loadFavorites() {
            const saved = localStorage.getItem('planetarium-favorites');
            return saved ? JSON.parse(saved) : [];
        }

        saveSettings() {
            localStorage.setItem('planetarium-settings', JSON.stringify(this.settings));
        }

        loadSettings() {
            const saved = localStorage.getItem('planetarium-settings');
            return saved ? JSON.parse(saved) : {
                darkMode: true,
                distanceUnits: 'km',
                temperatureUnits: 'celsius',
                animations: true
            };
        }

        getFavoritePlanets() {
            return this.planets.filter(planet => this.favorites.includes(planet.id));
        }

        clearData() {
            localStorage.removeItem('planetarium-favorites');
            localStorage.removeItem('planetarium-settings');
            this.favorites = [];
            this.settings = {
                darkMode: true,
                distanceUnits: 'km',
                temperatureUnits: 'celsius',
                animations: true
            };
        }
    }

    class PlanetariumUI {
        constructor(planetData) {
            this.planetData = planetData;
            this.currentPage = 'planets';
            this.searchBar = document.getElementById('planet-search');
            this.rotationSlider = document.getElementById('rotation-slider');
            this.canvasContext = null;

            this.initEvents();
        }

        initEvents() {
            document.getElementById('planets-refresher').addEventListener('ionRefresh', async (event) => {
                await this.planetData.fetchData();
                this.renderPlanetList();
                event.target.complete();
            });

            this.searchBar.addEventListener('ionInput', (event) => {
                this.filterPlanets(event.target.value);
            });

            this.rotationSlider.addEventListener('ionChange', (event) => {
                this.drawSolarSystem(event.detail.value);
            });

            document.getElementById('dark-mode-toggle').addEventListener('ionChange', (event) => {
                this.planetData.settings.darkMode = event.detail.checked;
                this.planetData.saveSettings();
                this.applySettings();
            });

            document.getElementById('animations-toggle').addEventListener('ionChange', (event) => {
                this.planetData.settings.animations = event.detail.checked;
                this.planetData.saveSettings();
            });

            document.getElementById('distance-units').addEventListener('ionChange', (event) => {
                this.planetData.settings.distanceUnits = event.detail.value;
                this.planetData.saveSettings();
                if (this.currentPage === 'planet-detail') {
                    this.renderPlanetDetail(document.querySelector('#detail-title').dataset.planetId);
                }
            });

            document.getElementById('temperature-units').addEventListener('ionChange', (event) => {
                this.planetData.settings.temperatureUnits = event.detail.value;
                this.planetData.saveSettings();
                if (this.currentPage === 'planet-detail') {
                    this.renderPlanetDetail(document.querySelector('#detail-title').dataset.planetId);
                }
            });

            document.getElementById('clear-data-button').addEventListener('click', () => {
                this.showConfirmClearData();
            });

            document.getElementById('favorite-button').addEventListener('click', (event) => {
                const planetId = document.querySelector('#detail-title').dataset.planetId;
                const isFavoriteNow = this.planetData.toggleFavorite(planetId);

                const button = event.target.closest('ion-button');
                const icon = button.querySelector('ion-icon');

                if (isFavoriteNow) {
                    button.textContent = ' Odebrat z oblíbených';
                    icon.setAttribute('name', 'star');
                } else {
                    button.textContent = ' Přidat do oblíbených';
                    icon.setAttribute('name', 'star-outline');
                }

                button.prepend(icon);
            });
        }

        async init() {
            await this.planetData.fetchData();
            this.renderPlanetList();
            this.renderOrbits();
            this.applySettings();

            document.getElementById('dark-mode-toggle').checked = this.planetData.settings.darkMode;
            document.getElementById('animations-toggle').checked = this.planetData.settings.animations;
            document.getElementById('distance-units').value = this.planetData.settings.distanceUnits;
            document.getElementById('temperature-units').value = this.planetData.settings.temperatureUnits;
        }

        applySettings() {
            document.body.classList.toggle('dark', this.planetData.settings.darkMode);
        }

        async showConfirmClearData() {
            const alert = document.createElement('ion-alert');
            alert.header = 'Potvrdit vymazání';
            alert.message = 'Opravdu chcete vymazat všechny uložené údaje? Tato akce je nevratná.';
            alert.buttons = [
                {
                    text: 'Zrušit',
                    role: 'cancel'
                },
                {
                    text: 'Vymazat',
                    role: 'destructive',
                    handler: () => {
                        this.planetData.clearData();
                        this.applySettings();
                        document.getElementById('dark-mode-toggle').checked = this.planetData.settings.darkMode;
                        document.getElementById('animations-toggle').checked = this.planetData.settings.animations;
                        document.getElementById('distance-units').value = this.planetData.settings.distanceUnits;
                        document.getElementById('temperature-units').value = this.planetData.settings.temperatureUnits;
                        this.renderFavoritesList();
                        this.showToast('Data byla úspěšně vymazána');
                    }
                }
            ];
            document.body.appendChild(alert);
            await alert.present();
        }

        async showToast(message) {
            const toast = document.createElement('ion-toast');
            toast.message = message;
            toast.duration = 2000;
            toast.position = 'bottom';
            document.body.appendChild(toast);
            await toast.present();
        }

        renderPlanetList() {
            const planetList = document.getElementById('planet-list');
            planetList.innerHTML = '';

            this.planetData.planets.forEach(planet => {
                const isFavorite = this.planetData.isFavorite(planet.id);

                const item = document.createElement('ion-item');
                item.classList.add('planet-item');
                item.button = true;

                item.innerHTML = `
                        <ion-avatar slot="start">
                            <div class="planet-marker ${planet.id}"></div>
                        </ion-avatar>
                        <ion-label>
                            <h2>${planet.name}</h2>
                            <p>${this.formatDistance(planet.semimajorAxis)} od Slunce</p>
                        </ion-label>
                        ${isFavorite ? '<ion-icon name="star" slot="end" class="favorites-icon"></ion-icon>' : ''}
                    `;

                item.addEventListener('click', () => {
                    this.showPlanetDetail(planet.id);
                });

                planetList.appendChild(item);
            });
        }

        renderOrbits() {
            const orbitContainer = document.querySelector('.planet-orbit');
            orbitContainer.innerHTML = '<div class="sun"></div>';

            const maxOrbitRadius = 130;

            const maxSemiMajorAxis = Math.max(...this.planetData.planets.map(p => p.semimajorAxis));

            this.planetData.planets.forEach(planet => {
                const orbitRadius = (planet.semimajorAxis / maxSemiMajorAxis) * maxOrbitRadius;
                const orbit = document.createElement('div');

                orbit.classList.add('orbit-path');
                orbit.style.width = `${orbitRadius * 2}px`;
                orbit.style.height = `${orbitRadius * 2}px`;

                const angle = Math.random() * 2 * Math.PI; // Náhodný úhel pro pozici
                const planetX = Math.cos(angle) * orbitRadius;
                const planetY = Math.sin(angle) * orbitRadius;

                const planetMarker = document.createElement('div');
                planetMarker.classList.add('planet-marker', planet.id);
                planetMarker.style.left = `calc(50% + ${planetX}px)`;
                planetMarker.style.top = `calc(50% + ${planetY}px)`;

                const planetName = document.createElement('div');
                planetName.classList.add('planet-name');
                planetName.textContent = planet.name;
                planetName.style.left = `calc(50% + ${planetX}px)`;
                planetName.style.top = `calc(50% + ${planetY + 15}px)`;

                planetMarker.addEventListener('click', () => {
                    this.showPlanetDetail(planet.id);
                });

                orbitContainer.appendChild(orbit);
                orbitContainer.appendChild(planetMarker);
                orbitContainer.appendChild(planetName);
            });
        }

        filterPlanets(searchText) {
            const planetList = document.getElementById('planet-list');
            const items = planetList.querySelectorAll('ion-item');

            searchText = searchText.toLowerCase();

            items.forEach(item => {
                const planetName = item.querySelector('h2').textContent.toLowerCase();
                if (planetName.includes(searchText)) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        showPlanetDetail(planetId) {
            const planet = this.planetData.getPlanetById(planetId);
            if (!planet) return;

            this.navigateTo('planet-detail');

            document.getElementById('detail-title').textContent = planet.name;
            document.getElementById('detail-title').dataset.planetId = planet.id;
            document.getElementById('detail-subtitle').textContent = `${planet.englishName} | ${planet.isPlanet ? 'Planeta' : 'Jiné těleso'}`;
            document.getElementById('detail-img').src = `https://api.le-systeme-solaire.net/assets/images/planets/${planet.id}.gif`;

            let description = '';
            if (planet.id === 'earth') {
                description = 'Země je naše domovská planeta, jediná známá planeta, která podporuje život. Je třetí planetou od Slunce a největší z terestrických planet.';
            } else if (planet.id === 'mercury') {
                description = 'Merkur je nejmenší a nejbližší planeta Slunce. Na povrchu má krátery podobné Měsíci a téměř žádnou atmosféru.';
            } else if (planet.id === 'venus') {
                description = 'Venuše, druhá planeta od Slunce, je nejžhavější planetou sluneční soustavy s hustou atmosférou tvořenou převážně oxidem uhličitým.';
            } else if (planet.id === 'mars') {
                description = 'Mars, čtvrtá planeta od Slunce, je známá jako Rudá planeta. Má tenkou atmosféru a povrch pokrytý železitým prachem, který jí dává načervenalou barvu.';
            } else if (planet.id === 'jupiter') {
                description = 'Jupiter je největší planeta sluneční soustavy a první z plynných obrů. Je známý svou Velkou červenou skvrnou, obrovskou bouří trvající stovky let.';
            } else if (planet.id === 'saturn') {
                description = 'Saturn je šestá planeta od Slunce a druhý největší plynný obr. Je nejznámější svým výrazným systémem prstenců.';
            } else if (planet.id === 'uranus') {
                description = 'Uran je sedmá planeta od Slunce a třetí největší planeta sluneční soustavy. Je jedinečný tím, že rotuje "na boku" s osou rotace téměř rovnoběžnou s rovinou oběhu.';
            } else if (planet.id === 'neptune') {
                description = 'Neptun je osmá a nejvzdálenější planeta od Slunce. Je ledovým obrem s bouřlivou atmosférou, kde vítr může dosahovat rychlosti až 2100 km/h.';
            } else {
                description = `${planet.name} je součástí sluneční soustavy a obíhá kolem Slunce ve vzdálenosti ${this.formatDistance(planet.semimajorAxis)}.`;
            }
            document.getElementById('detail-description').textContent = description;

            document.getElementById('detail-diameter').textContent = `${this.formatNumber(planet.meanRadius * 2)} km`;
            document.getElementById('detail-distance').textContent = this.formatDistance(planet.semimajorAxis);
            document.getElementById('detail-orbit-period').textContent = `${this.formatNumber(planet.sideralOrbit)} dní`;
            document.getElementById('detail-rotation-period').textContent = `${this.formatNumber(planet.sideralRotation)} hodin`;

            document.getElementById('detail-temperature').textContent = this.formatTemperature(planet.meanTemperature);

            document.getElementById('detail-moons').textContent = planet.moons ? planet.moons.length : 0;

            const isFavorite = this.planetData.isFavorite(planet.id);
            const favoriteButton = document.getElementById('favorite-button');
            const favoriteIcon = favoriteButton.querySelector('ion-icon');

            if (isFavorite) {
                favoriteButton.textContent = ' Odebrat z oblíbených';
                favoriteIcon.setAttribute('name', 'star');
            } else {
                favoriteButton.textContent = ' Přidat do oblíbených';
                favoriteIcon.setAttribute('name', 'star-outline');
            }
            favoriteButton.prepend(favoriteIcon);
        }

        renderFavoritesList() {
            const favoritesList = document.getElementById('favorites-list');
            favoritesList.innerHTML = '<ion-list-header><ion-label>Vaše oblíbené planety</ion-label></ion-list-header>';

            const favorites = this.planetData.getFavoritePlanets();

            if (favorites.length === 0) {
                const emptyItem = document.createElement('ion-item');
                emptyItem.innerHTML = '<ion-label class="ion-text-center">Zatím nemáte žádné oblíbené planety</ion-label>';
                favoritesList.appendChild(emptyItem);
            } else {
                favorites.forEach(planet => {
                    const item = document.createElement('ion-item');
                    item.classList.add('planet-item');
                    item.button = true;

                    item.innerHTML = `
                            <ion-avatar slot="start">
                                <div class="planet-marker ${planet.id}"></div>
                            </ion-avatar>
                            <ion-label>
                                <h2>${planet.name}</h2>
                                <p>${this.formatDistance(planet.semimajorAxis)} od Slunce</p>
                            </ion-label>
                            <ion-icon name="star" slot="end" class="favorites-icon"></ion-icon>
                        `;

                    item.addEventListener('click', () => {
                        this.showPlanetDetail(planet.id);
                    });

                    favoritesList.appendChild(item);
                });
            }
        }

        navigateTo(pageName) {
            this.currentPage = pageName;

            document.getElementById('planets-page').style.display = 'none';
            document.getElementById('planet-detail').style.display = 'none';
            document.getElementById('favorites-page').style.display = 'none';
            document.getElementById('map-page').style.display = 'none';
            document.getElementById('settings-page').style.display = 'none';
            document.getElementById('search-toolbar').style.display =
                (pageName === 'planets') ? 'block' : 'none';

            if (pageName === 'planet-detail') {
                document.getElementById('planet-detail').style.display = 'block';
                document.getElementById('page-title').textContent = 'Detail planety';
            } else if (pageName === 'planets') {
                document.getElementById('planets-page').style.display = 'block';
                document.getElementById('page-title').textContent = 'Planetárium';
            } else if (pageName === 'favorites') {
                document.getElementById('favorites-page').style.display = 'block';
                document.getElementById('page-title').textContent = 'Oblíbené planety';
                this.renderFavoritesList();
            } else if (pageName === 'map') {
                document.getElementById('map-page').style.display = 'block';
                document.getElementById('page-title').textContent = 'Mapa vesmíru';
                this.initCanvas();
                this.drawSolarSystem(0);
            } else if (pageName === 'settings') {
                document.getElementById('settings-page').style.display = 'block';
                document.getElementById('page-title').textContent = 'Nastavení';
            }
        }

        initCanvas() {
            const canvas = document.getElementById('solar-system-canvas');
            const container = canvas.parentElement;

            canvas.width = container.clientWidth;
            canvas.height = container.clientWidth;

            this.canvasContext = canvas.getContext('2d');
        }

        drawSolarSystem(rotation) {
            if (!this.canvasContext) return;

            const ctx = this.canvasContext;
            const canvas = ctx.canvas;
            const width = canvas.width;
            const height = canvas.height;

            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, width, height);
            ctx.fillStyle = '#fff';

            for (let i = 0; i < 100; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const radius = Math.random() * 1.5;
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fill();
            }

            const centerX = width / 2;
            const centerY = height / 2;

            const sunRadius = 20;
            const sunGradient = ctx.createRadialGradient(
                centerX, centerY, 0,
                centerX, centerY, sunRadius
            );
            sunGradient.addColorStop(0, '#ffff00');
            sunGradient.addColorStop(1, '#ff6600');

            ctx.fillStyle = sunGradient;
            ctx.beginPath();
            ctx.arc(centerX, centerY, sunRadius, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = 'rgba(255, 255, 0, 0.1)';
            ctx.beginPath();
            ctx.arc(centerX, centerY, sunRadius * 1.5, 0, Math.PI * 2);
            ctx.fill();

            const maxOrbitRadius = Math.min(width, height) / 2 - 30;

            const maxSemiMajorAxis = Math.max(...this.planetData.planets.map(p => p.semimajorAxis));

            this.planetData.planets.forEach((planet, index) => {
                const orbitRadius = (planet.semimajorAxis / maxSemiMajorAxis) * maxOrbitRadius;

                ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(centerX, centerY, orbitRadius, 0, Math.PI * 2);
                ctx.stroke();

                const planetAngle = ((index * 45) + parseInt(rotation)) * Math.PI / 180;
                const planetX = centerX + Math.cos(planetAngle) * orbitRadius;
                const planetY = centerY + Math.sin(planetAngle) * orbitRadius;

                let planetRadius = 3;
                if (planet.meanRadius > 20000) planetRadius = 8; // Gas giants
                else if (planet.meanRadius > 6000) planetRadius = 6; // Earth-sized
                else planetRadius = 4; // Small planets

                let planetColor = '#aaaaaa';
                if (planet.id === 'mercury') planetColor = '#b5b5b5';
                else if (planet.id === 'venus') planetColor = '#e6a57a';
                else if (planet.id === 'earth') planetColor = '#5992ca';
                else if (planet.id === 'mars') planetColor = '#c75d35';
                else if (planet.id === 'jupiter') planetColor = '#e0ae6f';
                else if (planet.id === 'saturn') planetColor = '#f9e07f';
                else if (planet.id === 'uranus') planetColor = '#9bd8df';
                else if (planet.id === 'neptune') planetColor = '#3b66d4';

                ctx.fillStyle = planetColor;
                ctx.beginPath();
                ctx.arc(planetX, planetY, planetRadius, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = '#ffffff';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(planet.name, planetX, planetY + 15);
            });
        }

        formatDistance(distance) {
            if (this.planetData.settings.distanceUnits === 'au') {
                return `${this.formatNumber(distance)} AU`;
            } else {
                const kmDistance = distance * 149597871; // 1 AU = ~149.6 mil. km
                if (kmDistance > 1000000000) {
                    return `${this.formatNumber(kmDistance / 1000000000)} mld. km`;
                } else if (kmDistance > 1000000) {
                    return `${this.formatNumber(kmDistance / 1000000)} mil. km`;
                } else {
                    return `${this.formatNumber(kmDistance)} km`;
                }
            }
        }

        formatTemperature(kelvin) {
            if (this.planetData.settings.temperatureUnits === 'celsius') {
                return `${this.formatNumber(kelvin - 273.15)} °C`;
            } else if (this.planetData.settings.temperatureUnits === 'fahrenheit') {
                return `${this.formatNumber((kelvin - 273.15) * 9/5 + 32)} °F`;
            } else {
                return `${this.formatNumber(kelvin)} K`;
            }
        }

        formatNumber(num) {
            if (isNaN(num)) return 'N/A';
            return Number(num).toLocaleString('cs-CZ', {
                maximumFractionDigits: 2,
                minimumFractionDigits: 0
            });
        }
    }

    let planetData = null;
    let planetariumUI = null;

    // app init
    document.addEventListener('DOMContentLoaded', function() {
        planetData = new PlanetData();
        planetariumUI = new PlanetariumUI(planetData);

        planetariumUI.init();
    });

    function navigateTo(page) {
        if (planetariumUI) {
            planetariumUI.navigateTo(page);
        }
    }

    function refreshData() {
        if (planetariumUI) {
            planetData.fetchData().then(() => {
                planetariumUI.renderPlanetList();
                planetariumUI.renderOrbits();
                planetariumUI.showToast('Data byla úspěšně aktualizována');
            });
        }
    }

    function showAboutModal() {
        const modal = document.getElementById('about-modal');
        modal.present();
    }

    function dismissAboutModal() {
        const modal = document.getElementById('about-modal');
        modal.dismiss();
    }

    window.addEventListener('resize', function() {
        if (planetariumUI && planetariumUI.currentPage === 'map') {
            planetariumUI.initCanvas();
            planetariumUI.drawSolarSystem(document.getElementById('rotation-slider').value);
        }
    });
</script>
</body>
</html>